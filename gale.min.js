!function(){function e(e){return this.identifier=e||"translateid",this.previousLanguage=null,this.currentLanguage=null,this.translationSourceLoaded=!1,this.translationRawSource=null,this.translationSource=null,this.translationMeta=null,this.availableLanguages=null,this.caching=!0,this.elementCache=[],this.translateFromCache=!0,this.debug=!0,this.isSourceIndexTypeFigured=!1,this.sourceIndexType=null,this}e.prototype.loadSourceFromJSON=function(e,a){var n=this;n.translationSourceLoaded=!1,$.getJSON(e,function(e){if(!(e&&e.meta&&e.translations))throw n.translationSourceLoaded=!1,new Error("JSON cannot be null and / or it must include meta and data objects");if(n.translationRawSource=e,n.translationMeta=e.meta,e.meta.availableLanguages)console.log("Meta 'availableLanguages' found for JSON translation source, skipping translation object language parsing"),n.availableLanguages=e.meta.availableLanguages,n.translationMeta.availableLanguagesCount=Object.keys(e.meta.availableLanguages).length;else{console.log("Meta 'availableLanguages' not found for JSON translation source, trying to parse directly from translations object");var t=[];for(var r in e.translations)t.push(r);t.length>0?(console.log("Parsing successful, but without availableLanguages-meta, availableLanguages will not be as exclusive"),n.availableLanguages=t,n.translationMeta.availableLanguagesCount=t.length):console.log("Parsing failed. Is translations object empty or incorrectly structured")}n.translationSource=e.translations,n.translationSourceLoaded=!0,a.call(n)}).fail(function(){throw n.translationSourceLoaded=!1,new Error("Failed to load translation source from JSON")})},e.prototype.translateApp=function(e,a){var n=this,t=null,r=!1;if(!n.translationSourceLoaded)throw new Error("Could not translate, translation source is not loaded!");if("normal"===n._figureTranslationIndexType())if("normal"==n._figureSuppliedLanguage(e))t=e;else if("shorthand"==n._figureSuppliedLanguage(e))t=n._shorthandToNormal(e);else{if("other"!=n._figureSuppliedLanguage(e))throw new Error("Something is wrong with supplied language and / or translation source indexes!");t=e}else{if("shorthand"!==n._figureTranslationIndexType())throw new Error("Something is wrong with supplied language and / or translation source indexes!");"normal"==n._figureSuppliedLanguage(e)?t=n._normalToShorthand(e):"shorthand"==n._figureSuppliedLanguage(e)?t=e:"other"==n._figureSuppliedLanguage(e)&&(t=e)}if(console.log("Translation index type smart detect successful (finalIndexFormat = "+t+")"),a&&n.elementCache.length>0){console.log("Translating cached elements (translateFromCache = "+a+"; elementCacheLength = "+n.elementCache.length+")"),n.debug&&console.time("Cached element translate time");for(var o in n.elementCache){var i=n.elementCache[o];if("undefined"==typeof i.data(n.identifier)||!i.data(n.identifier)||$.isEmptyObject(i.data(n.identifier)))return void(n.debug&&console.log("Skipped "+i[0].tagName));n._translateElement(i,t),n.debug&&console.log(i.data(n.identifier))}n.debug&&console.timeEnd("Cached element translate time"),r=!0}else console.log("Translating and caching noncached elements (caching = "+a+")"),n.debug&&console.time("Noncached element translate time"),$("*").each(function(){var e=$(this);return"undefined"==typeof e.data(n.identifier)||!e.data(n.identifier)||$.isEmptyObject(e.data(n.identifier))?void(n.debug&&console.log("Skipped "+e[0].tagName)):(n.caching&&(n._inElementCache(e)||n.elementCache.push(e)),n._translateElement(e,t),void(n.debug&&console.log(e.data(n.identifier))))}),n.debug&&console.timeEnd("Noncached element translate time"),r=!0;r&&(n.previousLanguage&&(n.previousLanguage=n.currentLanguage),n.currentLanguage="shorthand"===n._figureSuppliedLanguage(e)?n._shorthandToNormal(e):e,n.previousLanguage||(n.previousLanguage=n.currentLanguage))},e.prototype.getTranslationsById=function(e){var a=this,n=(a.availableLanguages,a._figureTranslationIndexType(),{});for(var t in a.translationSource){var r=a.translationSource[t];for(var o in r){var i=r[o];o===e&&(n[t]=i)}}return n},e.prototype.reverseTranslationLookup=function(e){var a=this,n={},t=!1,r=null;for(var o in a.translationSource){var i=a.translationSource[o];for(var l in i){var s=i[l];s===e&&(r=l,t=!0)}}if(t){for(var o in a.translationSource){var i=a.translationSource[o];for(var l in i){var s=i[l];l===r&&(n[o]=s)}}return n}return{}},e.prototype._figureSuppliedLanguage=function(e){var a=this,n=null,t=[];for(var r in a.translationSource)t.push(r);if(Array.isArray(a.availableLanguages))for(var o=0;o<a.availableLanguages.length;o++)a.availableLanguages[o]==e&&(n="other");else for(var r in a.availableLanguages)r==e?n="normal":a.availableLanguages[r].shorthand==e&&(n="shorthand");if(!n)throw new Error("Could not figure supplied 'TO-language'");return n},e.prototype._translateElement=function(e,a){var n=this,t=e,r=n.translationSource[a];"undefined"!=typeof r[t.data(n.identifier)]&&r[t.data(n.identifier)]||console.log("'"+a+"' Translation not found for id '"+t.data(n.identifier)+"'"),t.is('input[type="button"], input[type="submit"]')?(n.debug&&console.log("Translated element = BUTTON INPUT"),t.attr("value",r[t.data(n.identifier)])):t.is('input[type="text"], input[type="password"], input[type="textarea"], input[type="textbox"]')?(n.debug&&console.log("Translated element = TEXT INPUT"),t.attr("placeholder",r[t.data(n.identifier)])):t.html(r[t.data(n.identifier)])},e.prototype._figureTranslationIndexType=function(){var e=this;if(e.isSourceIndexTypeFigured&&e.sourceIndexType)return e.sourceIndexType;var a=Object.keys(e.translationSource).length,n=0;for(var t in e.translationSource)n+=t.length;return e.debug&&(console.log("Total: "+a),console.log("Sum: "+n),console.log("Avg: "+Math.ceil(n/a))),e.sourceIndexType=Math.ceil(n/a)>4?"normal":"shorthand",e.isSourceIndexTypeFigured=!0,e.sourceIndexType},e.prototype._normalToShorthand=function(e){var a=this;return a.availableLanguages[e].shorthand||null},e.prototype._shorthandToNormal=function(e){var a=this;for(var n in a.availableLanguages)if(a.availableLanguages[n].shorthand==e)return n;return null},e.prototype._inElementCache=function(e){var a=this;for(var n in a.elementCache)if(a.elementCache[n].is(e))return!0;return!1},"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):window.Gale=e}();